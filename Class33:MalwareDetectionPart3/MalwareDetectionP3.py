#!/usr/bin/env python3

# File Name: MalwareDetectionP3.py
# Author: Devin Iverson
# Date: 10/18/2022
# Purpose: 

from pathlib import Path, PurePosixPath
import hashlib
import datetime
import os

def search(t_folder):
    targets_found = sorted(Path(t_folder).glob('**/*.*'))
    return targets_found

'''
def SetTargetFile():
    target_file = str(input('Enter target file name including suffix(.py,.txt,.json,.csv): '))
    return target_file
'''

def SetTargetDir():
    target_dir = str(input('Enter target directory name: '))
    return target_dir

def main():
    #targetFile = SetTargetFile()
    targetFolder = SetTargetDir()
    counter = 0

    found = search(targetFolder)
    for target in found:
        target_path = str(target)
        target_name = PurePosixPath(target).name
        ct = datetime.datetime.now()
        file_size = os.path.getsize(target_path)
        
        with open(target,"rb") as hash_file:
            hash_file_contents = hash_file.read()
            md5_sum = hashlib.md5(hash_file_contents)
            print("{} | {} | {} | {} bytes | {}".format(ct, target_name, md5_sum.hexdigest(), file_size, target_path))
        counter+=1
        #print(target_name + ' | ' + target_path)

    print('Total files scanned: ' + str(counter))
main()